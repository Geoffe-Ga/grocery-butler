{
  "number": 1,
  "title": "Foundation: schema, models, config, and project dependencies",
  "state": "open",
  "labels": [
    {"name": "phase:0-foundation"},
    {"name": "priority:P0"},
    {"name": "component:backend"}
  ],
  "milestone": {"title": "Phase 1: Wire the Skeleton"},
  "body": "## Summary\n\nCreate the foundational layer that every other module depends on: the database schema, Pydantic models (the shared type system), configuration loading, and project dependencies.\n\n## Context\n\nThis is step zero of tracer-code. Nothing else can start until this exists. The models define the data contracts between every module. The schema defines persistence. The config validates the environment.\n\n## Acceptance Criteria\n\n### db/schema.sql\n- [ ] All 7 tables from spec: `recipes`, `recipe_ingredients`, `pantry_staples`, `household_inventory`, `brand_preferences`, `preferences`, `product_mapping`\n- [ ] All indexes: `idx_household_inventory_status`, `idx_product_mapping_ingredient`\n- [ ] Foreign key constraints with `ON DELETE CASCADE` on `recipe_ingredients`\n- [ ] Comments explaining the pantry-vs-inventory override rule\n- [ ] `product_mapping` table included even though nothing writes to it yet (Safeway future-proofing)\n\n### grocery_butler/models.py\n- [ ] All enums: `IngredientCategory`, `PriceSensitivity`, `OrganicPreference`, `FulfillmentType`, `InventoryStatus`, `BrandPreferenceType`, `BrandMatchType`, `SubstitutionSuitability`\n- [ ] All current-use models: `Ingredient`, `ParsedMeal`, `ShoppingListItem`, `InventoryItem`, `InventoryUpdate`, `BrandPreference`\n- [ ] All future-Safeway models: `SafewayProduct`, `SubstitutionOption`, `SubstitutionResult`, `CartItem`, `FulfillmentOption`, `CartSummary`\n- [ ] Type hints everywhere, `str | None` union syntax (3.11+)\n\n### grocery_butler/config.py\n- [ ] Load from `.env` via `python-dotenv`\n- [ ] Typed config dataclass/model with fields: `anthropic_api_key`, `discord_bot_token`, `discord_user_id`, `database_path`, `flask_port`, `flask_debug`, `default_servings`, `default_units`\n- [ ] Validate required vars at import time (fail fast with clear error)\n- [ ] Expose a singleton `config` object, not raw `os.getenv()` calls\n\n### .env.example\n- [ ] All config vars with placeholder values\n\n### requirements.txt (mealbot-specific)\n- [ ] `discord.py>=2.3.0`, `anthropic>=0.40.0`, `flask>=3.0.0`, `aiosqlite>=0.19.0`, `pydantic>=2.5.0`, `python-dotenv>=1.0.0`, `pytest>=8.0.0`, `pytest-asyncio>=0.23.0`\n\n### Database initialization\n- [ ] Helper function `init_db(db_path)` that creates tables and pre-populates pantry staples:\n  ```python\n  DEFAULT_PANTRY = [\n      (\"salt\", \"pantry_dry\"), (\"black pepper\", \"pantry_dry\"),\n      (\"olive oil\", \"pantry_dry\"), (\"vegetable oil\", \"pantry_dry\"),\n      (\"butter\", \"dairy\"), (\"garlic\", \"produce\"),\n      (\"onion\", \"produce\"), (\"sugar\", \"pantry_dry\"),\n      (\"flour\", \"pantry_dry\"), (\"soy sauce\", \"pantry_dry\"),\n  ]\n  ```\n- [ ] Enable WAL mode on connection: `PRAGMA journal_mode=WAL`\n- [ ] Idempotent — safe to call multiple times (use `IF NOT EXISTS`)\n\n## File Inventory\n\n```\ngrocery_butler/\n├── db/\n│   └── schema.sql\n├── models.py\n├── config.py\n.env.example\nrequirements.txt  (update with mealbot deps)\n```\n\n## Blocked By\n\nNothing — this is the first issue.\n\n## Blocks\n\n#2 (tracer wire), #3 (prompt templates), #4 (recipe store), #5 (pantry manager)"
}
