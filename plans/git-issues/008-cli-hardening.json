{
  "number": 8,
  "title": "CLI hardening: wire real modules into cli.py with full pipeline",
  "state": "open",
  "labels": [
    {"name": "phase:2-core"},
    {"name": "priority:P1"},
    {"name": "component:backend"}
  ],
  "milestone": {"title": "Phase 2: Replace Stubs"},
  "body": "## Summary\n\nUpdate `cli.py` to use the real (non-stub) modules. After this, the CLI is a fully functional meal planning tool from the terminal — proving the entire backend pipeline works before building any UI.\n\n## Context\n\nThe spec calls for a CLI smoke test at step 6. By this point, recipe_store (#4), pantry_manager (#5), meal_parser (#6), and consolidator (#7) should all be real. The CLI wires them together and provides a terminal interface for the full workflow.\n\n## Acceptance Criteria\n\n### Commands\n\n#### `plan` — Full meal-to-shopping-list pipeline\n- [ ] `python -m grocery_butler.cli plan \"chicken tikka masala, caesar salad, carbonara\"`\n- [ ] Parses comma-separated meal names\n- [ ] Optional `--servings N` flag (default from config)\n- [ ] Optional `--save` flag to save unknown recipes to memory\n- [ ] Runs: meal_parser.parse_meals() -> consolidator.consolidate() -> formatted output\n- [ ] Output: formatted shopping list grouped by category, showing quantities, units, and which meals need each item\n- [ ] Restock items shown in separate section if any exist\n\n#### `stock` — Inventory management\n- [ ] `python -m grocery_butler.cli stock` — list all inventory with status indicators\n- [ ] `python -m grocery_butler.cli stock out \"soy sauce\"` — mark item as out\n- [ ] `python -m grocery_butler.cli stock low \"butter\"` — mark item as low\n- [ ] `python -m grocery_butler.cli stock good \"salt\"` — mark item as on_hand\n- [ ] `python -m grocery_butler.cli stock add \"parmesan\" dairy` — track new item\n\n#### `restock` — Restock queue\n- [ ] `python -m grocery_butler.cli restock` — show restock queue\n- [ ] `python -m grocery_butler.cli restock clear` — clear restock queue\n\n#### `recipes` — Recipe management\n- [ ] `python -m grocery_butler.cli recipes` — list all saved recipes\n- [ ] `python -m grocery_butler.cli recipes show \"tikka masala\"` — show recipe details\n- [ ] `python -m grocery_butler.cli recipes forget \"tikka masala\"` — delete recipe\n\n#### `pantry` — Pantry staple management\n- [ ] `python -m grocery_butler.cli pantry` — list pantry staples\n- [ ] `python -m grocery_butler.cli pantry add \"cumin\" pantry_dry` — add staple\n- [ ] `python -m grocery_butler.cli pantry remove \"cumin\"` — remove staple\n\n### Output formatting\n- [ ] Shopping list: grouped by category, aligned columns, item count and meal count in header\n- [ ] Inventory: status-colored output (if terminal supports it), or text indicators [ON_HAND] [LOW] [OUT]\n- [ ] Recipes: table with name, times ordered, ingredient count\n\n### Error handling\n- [ ] Missing `.env` or API key: clear error message pointing to `.env.example`\n- [ ] Claude API failure: print error, suggest retry\n- [ ] Unknown command: print usage help\n\n## Gate Check\n\nThis is the \"tracer bullet hits the target\" moment. Run this sequence and verify each step works:\n\n```bash\npython -m grocery_butler.cli pantry                          # see default staples\npython -m grocery_butler.cli stock add \"milk\" dairy           # track milk\npython -m grocery_butler.cli stock out \"milk\"                 # mark it out\npython -m grocery_butler.cli restock                          # see milk in queue\npython -m grocery_butler.cli plan \"spaghetti carbonara\" --save # plan + save recipe\npython -m grocery_butler.cli recipes                          # see saved recipe\npython -m grocery_butler.cli plan \"spaghetti carbonara\"       # uses saved recipe\n```\n\n## Blocked By\n\n#4 (recipe store), #5 (pantry manager), #6 (meal parser), #7 (consolidator)\n\n## Blocks\n\n#9 (web dashboard — proves the pipeline works before building UI)"
}
